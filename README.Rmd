---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = FALSE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

library(dplyr)
library(lz4lite)
```

# lz4lite

<!-- badges: start -->
![](https://img.shields.io/badge/cool-useless-green.svg)
[![CRAN](https://www.r-pkg.org/badges/version/yyjsonr)](https://cran.r-project.org/package=yyjsonr)
[![R-CMD-check](https://github.com/coolbutuseless/lz4lite/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/coolbutuseless/lz4lite/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

`lz4lite` provides access to the extremely fast compression in [lz4](https://github.com/lz4/lz4)
for performing in-memory compression of any R ojbect.

`lz4` code provided with this package is v1.10.0.


### What's in the box

* **For arbitrary R objects**
    * `lz4_serialize()`/`lz4_unserialize()` serialize and compress any R object.
* **For raw vectors**
    * `lz4_compress()`/`lz4_decompress()`


### Installation

You can install from [GitHub](https://github.com/coolbutuseless/lz4lite) with:

``` r
# install.package('remotes')
remotes::install_github('coolbutuseless/lz4lite)
```

Pre-built source/binary versions can also be installed from [R-universe](https://r-universe.dev)

``` r
install.packages('lz4lite', repos = c('https://coolbutuseless.r-universe.dev', 'https://cloud.r-project.org'))
```



## Basic usage of lz4lite

```{r}
dat <- mtcars


buf <- lz4_serialize(dat)
length(buf) # Number of bytes

# compression ratio
length(buf)/length(serialize(dat, NULL))

head(lz4_unserialize(buf))
```






## Technical bits


### Framing of the compressed data

* `lz4lite` does **not** use the standard LZ4 frame to store data.
* The compressed representation is the compressed data prefixed with 
  a custom 8 byte header consisting of 
    * 3 bytes = 'LZ4' 
    * If this was produced with `lz4_serialize()` the next byte is 'S', 
      otherwise 'C'.
    * 4-byte length value i.e. the number of bytes in the 
      original uncompressed data.
* This data representation 
    * is not compatible with the standard LZ4 frame 
      format.
    * is likely to evolve (so currently do not plan on compressing something in 
      one version of `lz4lite` and decompressing in another version.)



